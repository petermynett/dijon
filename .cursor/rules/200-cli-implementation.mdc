---
description: Safe usage rules for the project CLI (Typer-based): entrypoint, allowed actions, and guardrails.
globs:
  - "src/**/cli/**/*.py"
  - "src/**/__main__.py"
alwaysApply: false
---

# CLI Usage & Safety Rules

This rule governs **how the CLI may be used or modified**, not how it is implemented.

Implementation details and workflows live in:
- `docs/cli_implementation.md`

## Entrypoint

- The CLI entrypoint is `src/<pkg>/cli/main.py:main`
- The Typer app defined there is the **only** supported public CLI interface
- Do not introduce additional entrypoints without approval

## Default Behavior

CLI commands MUST be safe by default:

- No commands can be created without consulting `docs/cli_implementation.md`
- Commands should explain what they will do before doing it
- `--help` output must be accurate and up to date

## Mutating Actions (Strict)

Any command that **writes files**, **modifies data**, or **touches the database** MUST:

- Provide a preview or `--dry-run` mode
- Clearly log intent **before** performing the action
- Be reversible where feasible, or clearly documented if not

Silent side effects are forbidden.

## Forbidden Without Explicit Approval

Do **not** add CLI commands that:

- Perform destructive operations by default
- Modify schemas, manifests, or canonical data formats
- Write to disk or databases without user confirmation
- Make network calls or external API requests
- Install dependencies or alter environments

If in doubt, stop and ask. Consult `docs/cli_implementation.md` for more detailed information.

## Output & Exit Codes

- Use stdout for normal command output
- Use stderr for warnings and errors
- Exit with non-zero status on failure
- Do not swallow exceptions or errors

## Scope Control

- Avoid introducing new global options or flags unless required
- Prefer extending existing commands over adding new top-level commands
- Do not refactor CLI structure unless explicitly requested
- Do not do any major edits or refactors without consulting:
`docs/cli_implementation.md`
`README.md`
`AGENTS.md`
`ARCHITECTURE.md`
`DATA.md`

## Documentation

- If CLI behavior or interface changes, update `README.md`
- Implementation details belong in `docs/cli_implementation.md`